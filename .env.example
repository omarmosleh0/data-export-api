# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# Cloud SQL Connection (Unix Socket for Cloud Run deployment)
# Format: /cloudsql/PROJECT_ID:REGION:INSTANCE_NAME
DB_SOCKET_PATH=

# For LOCAL DEVELOPMENT with Cloud SQL Proxy:
# 1. Run: cloud_sql_proxy -instances=wileyconnect:us-west1:postgres=tcp:5432
# 2. Then use: DB_SOCKET_PATH=127.0.0.1
# DB_SOCKET_PATH=127.0.0.1

# Database Credentials
DB_USER=postgres
DB_PASS=your_secure_password_here
DB_NAME=postgres

# Cloud SQL Instance Connection Name
CLOUD_SQL_CONNECTION_NAME=

# ============================================================================
# CONNECTION POOL CONFIGURATION
# ============================================================================

# Pool Size: Number of persistent connections maintained
# Cloud SQL default max_connections = 100, so keep pool_size * max_instances < 100
DB_POOL_SIZE=10

# Max Overflow: Additional connections allowed above pool_size during peak load
# These connections are created on-demand and closed when idle
DB_MAX_OVERFLOW=5

# ============================================================================
# JWT AUTHENTICATION
# ============================================================================

# >>> CRITICAL: These MUST be set for authentication to work
# Get these values from your authentication provider admin console

# Issuer: Your  authorization server URL
# Example: https://wiley-dev.okta.com/oauth2/default
# Find it in: 'Your Auth Provider' Admin > Security > API > Authorization Servers
JWT_ISSUER=https://your-company.okta.com/oauth2/default

# Audience: The API identifier this service validates tokens for
# This should match the "aud" claim in your JWT tokens
# Example: query-engine-api, api://data-platform
JWT_AUDIENCE=query-engine-api

# ============================================================================
# >>> NEW: GOOGLE CLOUD STORAGE CONFIGURATION
# ============================================================================

# Default GCS bucket for exports
# This bucket will be used if not specified in API requests
# IMPORTANT: Service account must have Storage Object Creator role on this bucket
GCS_EXPORT_BUCKET=data-exports

# >>> OPTIONAL: GCS Configuration
# Uncomment to customize GCS behavior

# Custom folder prefix for all exports (default: "exports")
# GCS_FOLDER_PREFIX=data-exports

# Enable/disable public access to exported files (default: false)
# WARNING: Only enable if exports don't contain sensitive data
# GCS_MAKE_FILES_PUBLIC=false

# Retention policy in days (auto-delete old exports)
# Useful for cost management - delete exports older than X days
# GCS_RETENTION_DAYS=30

# ============================================================================
# APPLICATION SETTINGS
# ============================================================================

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Enable debug mode (more verbose logging, auto-reload)
# NEVER enable in production
DEBUG=false

# API version
API_VERSION=1.0.0

# ============================================================================
# CLOUD RUN SPECIFIC (Set automatically by Cloud Run, don't change)
# ============================================================================

# PORT is automatically set by Cloud Run (usually 8080)
# PORT=8080

# Google Application Credentials (automatically set in Cloud Run)
# For local development, point to service account key file:
# GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account-key.json

# ============================================================================
# SECURITY NOTES
# ============================================================================

# ðŸ”’ NEVER commit this file with real credentials to version control
# ðŸ”’ Use Google Secret Manager for production secrets
# ðŸ”’ Rotate DB passwords regularly (every 90 days recommended)
# ðŸ”’ Use separate service accounts for dev/staging/prod environments
# ðŸ”’ Grant minimum required IAM permissions (principle of least privilege)

# ============================================================================
# IAM REQUIREMENTS FOR GCS EXPORT
# ============================================================================

# The Cloud Run service account needs these permissions:
#
# 1. Storage Object Creator (on export bucket):
#    gcloud storage buckets add-iam-policy-binding gs://BUCKET_NAME \
#      --member="serviceAccount:SERVICE_ACCOUNT@PROJECT.iam.gserviceaccount.com" \
#      --role="roles/storage.objectCreator"
#
# 2. Storage Object Viewer (if you need to list/verify files):
#    gcloud storage buckets add-iam-policy-binding gs://BUCKET_NAME \
#      --member="serviceAccount:SERVICE_ACCOUNT@PROJECT.iam.gserviceaccount.com" \
#      --role="roles/storage.objectViewer"
#
# 3. Cloud SQL Client (for database connection):
#    Already configured if Cloud Run can connect to Cloud SQL

# ============================================================================
# DEPLOYMENT CHECKLIST
# ============================================================================

# Before deploying to production:
# âœ“ Set all JWT_* variables with production Okta values
# âœ“ Use strong DB_PASS (min 16 chars, alphanumeric + symbols)
# âœ“ Create GCS_EXPORT_BUCKET and configure lifecycle rules
# âœ“ Grant IAM permissions to Cloud Run service account
# âœ“ Set DB_POOL_SIZE based on expected load (start with 10)
# âœ“ Configure CORS origins in main.py for production domains
# âœ“ Enable Cloud Logging for monitoring
# âœ“ Set up Cloud Monitoring alerts for errors/latency
